---
title: "Articoli Precedenti"
output: html_document
---

---

## Gross domestic product (GDP) per capita

### Dati Eurostat 1995-2024

#### Unit of measure: Euro

```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", fig.align="left"}

library(eurostat)
library(kableExtra)
library(dplyr)
library(data.table)
library(ggplot2)

A <- get_eurostat("nama_10_pc" , cache = TRUE, update_cache = FALSE)
B <- label_eurostat(A)
setDT(B)

C <- B[, -c(1)]

C$TIME_PERIOD <- substr(C$TIME_PERIOD, 1, 4)

C <- C[unit == "Current prices, purchasing power standard (PPS, EU27 from 2020) per capita"]

C <- C[na_item == "Gross domestic product at market prices"]

C1 <- C[geo == "Italy"]

C2 <- C[geo == "Germany"]

D = C1[,c(4,5)]
E = C2[,c(4,5)]

combined_data <- bind_rows(
  D %>% mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), Source = "Italy"),
  E %>% mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), Source = "Germany")
)

all_years <- sort(unique(combined_data$TIME_PERIOD))

ggplot(combined_data, aes(x = TIME_PERIOD, y = values, color = Source)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(color = NULL) + 
  scale_x_continuous(
    breaks = all_years,
    labels = all_years
  ) +
  scale_color_manual(values = c("Italy" = "darkblue", "Germany" = "darkred")) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 8),
    plot.title = element_blank(),
    axis.title = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    plot.margin = margin(t = 10, r = 10, b = 10, l = 10),
    legend.position = c(0.4, 0.85),
    legend.justification = c("right", "bottom"),
    legend.title = element_blank(), 
    legend.background = element_rect(fill = NA, color = NA) 
  )

```



\vspace{0.5cm}

---

## QUESTIONARIO EVOLUZIONI PERCETTIVE


Compila il [QUESTIONARIO EVOLUZIONI PERCETTIVE](https://worldcharty.shinyapps.io/EVOLUZIONI-PERCETTIVE/)


```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", fig.align="left"}

library(tidyverse)
library(RColorBrewer)
library(googlesheets4)

YOUR_GOOGLE_SHEET_URL <- "[https://docs.google.com/spreadsheets/d/1ZRHdQIr4kLsCISFrueQPUQprZBrynCoCcY6Yn9A-igM/edit?usp=sharing](https://docs.google.com/spreadsheets/d/1ZRHdQIr4kLsCISFrueQPUQprZBrynCoCcY6Yn9A-igM/edit?usp=sharing)"

generate_base_pie_chart <- function(data_column_values, title_label) {
    if (all(is.na(data_column_values)) || length(data_column_values) == 0) {
        return(NULL)
    }
    
    plot_data <- tibble(
        value_raw = data_column_values
    ) %>%
        mutate(
            value_display = case_when(
                is.na(value_raw) ~ "Non Risposto",
                TRUE ~ as.character(value_raw)
            )
        ) %>%
        count(value_display, name = "count")
    
    if (nrow(plot_data) == 0) {
        return(NULL)
    }

    ordered_levels <- c(
        sort(as.character(plot_data$value_display[plot_data$value_display != "Non Risposto"])),
        if ("Non Risposto" %in% plot_data$value_display) "Non Risposto"
    )
    plot_data$value_display <- factor(plot_data$value_display, levels = unique(ordered_levels))

    num_categories <- n_distinct(plot_data$value_display)

    colors <- if (num_categories <= 12) {
        brewer.pal(max(3, num_categories), "Set3") 
    } else {
        colorRampPalette(brewer.pal(8, "Dark2"))(num_categories)
    }
    
    if ("Non Risposto" %in% levels(plot_data$value_display)) {
        na_index <- which(levels(plot_data$value_display) == "Non Risposto")
        colors[na_index] <- "lightgrey"
    }

    ordered_colors <- colors[match(levels(plot_data$value_display), levels(plot_data$value_display))]

    plot_data <- plot_data %>%
        mutate(
            percentage = count / sum(count) * 100,
            label_text = paste0(value_display, "\n", round(percentage, 1), "%")
        )
    
    pie(plot_data$count, 
        labels = plot_data$label_text, 
        col = ordered_colors, 
        cex = 0.8) 
    
    title(main = title_label, line = -1.5, cex.main = 1) 
}


options(gargle_oauth_cache = ".secrets") 
googlesheets4::gs4_auth(cache = ".secrets", email = TRUE)


raw_data <- tryCatch({
    googlesheets4::read_sheet(YOUR_GOOGLE_SHEET_URL, sheet = 1)
}, error = function(e) {
    warning("Errore durante la lettura del Google Sheet: ", e$message)
    return(NULL)
})

if (is.null(raw_data) || nrow(raw_data) == 0) {
    stop("Nessun dato valido Ã¨ stato caricato dal Google Sheet. Impossibile generare i grafici.")
} 

columns_to_plot <- setdiff(names(raw_data), c("timestamp", "user_code_hash"))

num_plots <- length(columns_to_plot)
if (num_plots == 0) {
    stop("Nessuna colonna valida trovata per generare i grafici.")
}

cols_per_row <- 4 
rows_needed <- ceiling(num_plots / cols_per_row)

par(mfrow = c(rows_needed, cols_per_row), 
    mar = c(0.5, 0.5, 2, 0.5), 
    oma = c(0, 0, 1, 0)) 

for (col_name in columns_to_plot) {
    current_values <- raw_data[[col_name]]
    generate_base_pie_chart(current_values, col_name)
}

par(mfrow = c(1, 1), mar = c(5.1, 4.1, 4.1, 2.1), oma = c(0,0,0,0))

```



















